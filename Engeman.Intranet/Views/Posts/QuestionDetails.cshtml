@using Microsoft.AspNetCore.Http;

<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  @*CSS*@
  <link rel="stylesheet" href="~/css/questionDetails/questiondetails.css" />
  <link rel="stylesheet" href="~/plugins/wysiwyg/css/style.css" />
  @*JavasScript*@
  <script type="text/javascript" src="~/js/custom.js"></script>  
</head>

<body>
  <div data-backdrop="true" id="confirm-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title"><h5>Apagar o comentário?</h5></div>
        </div>
        <div class="modal-body">
          Se houver quaisquer arquivos associados ao comentário, eles também serão excluídos
        </div>
        <div class="modal-footer">
          <button id="confirm-delete" type="button" class="btn btn-success" data-comment-id="">Sim</button>
          <button id="cancel-delete" type="button" class="btn btn-danger">Não</button>
        </div>
      </div>
    </div>
  </div>

  <div class="page-header">
    <div class="page-title">
      <h3>Detalhes da Postagem</h3>
      @*<span>Good morning, @Model.Name!</span>*@
    </div>
    <!-- Page Stats -->
    <ul class="page-stats">
      <li>
        <div class="summary">
          <span>New orders</span>
          <h3>17,561</h3>
        </div>
        <div id="sparkline-bar" class="graph sparkline hidden-xs">20,15,8,50,20,40,20,30,20,15,30,20,25,20</div>
        <!-- Use instead of sparkline e.g. this:
        <div class="graph circular-chart" data-percent="73">73%</div>
        -->
      </li>
      <li>
        <div class="summary">
          <span>My balance</span>
          <h3>$21,561.21</h3>
        </div>
        <div id="sparkline-bar2" class="graph sparkline hidden-xs">20,15,8,50,20,40,20,30,20,15,30,20,25,20</div>
      </li>
    </ul>
    <!-- /Page Stats -->
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="tabbable tabbable-custom tabbable-full-width">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab_1_1" data-toggle="tab">Postagem</a></li>
          <li><a href="#tab_1_2" data-toggle="tab">Autor</a></li>
          <li><a href="#tab_1_3" data-toggle="tab">Comentar</a></li>
        </ul>
        <div class="tab-content row">
          <div class="tab-pane active" id="tab_1_1">
            <div class="col-md-12">
              <div class="widget box">
                <div class="widget-content">
                  <form>
                    <div class="widget-content">
                      <dl class="dl-horizontal">
                        <dt>Id:</dt>
                        <dd>@ViewBag.Post.Id</dd>
                        <dt>Data:</dt>
                        <dd>@ViewBag.Post.ChangeDate</dd>
                        <dt>Assunto:</dt>
                        <dd>@ViewBag.Post.Subject</dd>
                        <dt>Descrição:</dt>
                        <dd>@ViewBag.Post.Description</dd>
                      </dl>
                    </div>
                    <div class="form-actions">
                      <a class="btn pull-left back-to-list-button">Voltar para a lista</a>
                    </div>
                  </form>
                </div>
              </div>
              <!--=== Accordion ===-->
              <div class="row">
                <div class="comments col-md-12">
                  <div class="widget">
                    <div>
                      @if (ViewBag.PostComments.Count == 0)
                      {
                        <h4>0 comentários</h4>
                      }
                      else
                      {
                        <h4><span id="comment-count">@ViewBag.PostComments.Count</span> comentário(s)</h4>
                      }
                    </div>
                    @for (int i = 0; i < ViewBag.PostComments.Count; i++)
                    {
                      <div class="col-md-12 comment-box" data-user-id="@ViewBag.PostComments[i].UserId" data-comment-id="@ViewBag.PostComments[i].Id">

                        <div id="editor-content-view" class="editor-content-view">@Html.Raw(@ViewBag.PostComments[i].Description)</div>
                        <div>
                          @if (@ViewBag.PostComments[i].Files.Count > 0)
                          {
                            <dl class="file-list">
                              Anexo(s):
                              @for (int j = 0; j < @ViewBag.PostComments[i].Files.Count; j++)
                              {
                                <dd class="file"><a href="@Url.Action("showcommentfile", "posts", new { idComment = ViewBag.PostComments[i].Id, file = j })" target="_blank">@ViewBag.PostComments[i].Files[j].Name</a></dd>
                              }
                            </dl>
                          }
                        </div>
                        <div>
                          @if (ViewBag.PostComments[i].UserId == Context.Session.GetInt32("_UserAccountId"))
                          {
                            <div id="comment-action-buttons" class="col-md-10">
                              <button class="comment-edit-btn btn btn-xs">Editar</button>
                              <button class="comment-delete-btn btn btn-xs">Apagar</button>
                            </div>
                          }                          
                            <figure class="fir-image-figure pull-right">
                              <a class="fir-imageover" rel="noopener" target="_blank" href="#">
                                @{var baseAux = Convert.ToBase64String(ViewBag.PostComments[i].Photo);
                                  var imasrcAux = string.Format("data:image/png;base64,{0}", baseAux);
                                }
                                <img class="fir-author-image fir-clickcircle" src='@imasrcAux' />
                              </a>
                              <figcaption>
                                <div class="fig-author-figure-title">@ViewBag.PostComments[i].Username</div>
                                <div class="fig-author-figure-title">@ViewBag.PostComments[i].DepartmentName</div>
                                <div class="fig-author-figure-title">@ViewBag.PostComments[i].ChangeDate</div>
                              </figcaption>
                            </figure>                        
                          <div class="widget-header"></div>
                        </div>
                      </div>
                    }                    
                  </div> <!-- /.widget .box -->
                </div> <!-- /.col-md-12 -->
              </div> <!-- /.row -->
              <!-- /Accordion -->
            </div>
          </div>
          <div class="tab-pane" id="tab_1_2">
            <div class="col-md-12">
              <div class="widget box">
                <div class="widget-content">
                  <form class="form-vertical">
                    <div class="form-group">
                      <div class="row">
                        <div class="col-md-3">
                          @{ var base64 = Convert.ToBase64String(ViewBag.UserAccount.Photo);
                            var imasrc = string.Format("data:image/png;base64,{0}", base64);
                          }
                          <img id="author-img" src='@imasrc' />
                          <a href="javascript:void(0);" class="list-group-item"><span class="badge">@ViewBag.PostsCount</span>Postagens realizadas</a>
                          <a href="javascript:void(0);" class="list-group-item">Postagens respondidas</a>
                        </div>
                        <div class="col-md-6">
                          <h2>@ViewBag.UserAccount.Name</h2>
                          <dl class="dl-horizontal">
                            <dt>Usuário de Domínio:</dt>
                            <dd>@ViewBag.UserAccount.DomainAccount</dd>
                            <dt>E-mail:</dt>
                            <dd>@ViewBag.UserAccount.Email</dd>
                            <dt>Setor:</dt>
                            <dd>@ViewBag.Department.Description</dd>
                            <dt>Descrição Pessoal:</dt>
                            <dd>@ViewBag.UserAccount.Description</dd>
                          </dl>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="form-actions">
                        <a class="btn pull-left back-to-list-button">Voltar para a lista</a>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane active" id="tab_1_3">
            <div class="col-md-12">
              <div class="row">
                <div class="col-md-10 col-md-offset-1">
                  <h3>@ViewBag.Post.Subject</h3>
                  <div class="well">
                    @ViewBag.Post.Description
                  </div>
                </div>
              </div>

              <div class="widget box answer-box">
                <div class="widget-content">
                  <form class="form-horizontal row-border" id="comment-form" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                      <label class="col-md-2 control-label">Comentário<span class="required">*</span></label>
                      <div class="col-md-10">
                        <div id="editor-toolbar" style="border-bottom: 1px solid #ccc;"></div>
                        <div id="editor-text-area"></div>
                        <input id="description" class="form-control" name="description" type="hidden">
                      </div>
                      <div class="col-md-offset-2 col-md-10 panel-group">
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h3 class="panel-title">
                              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                Pré-visualizar comentário
                              </a>
                            </h3>
                          </div>
                          <div id="collapseOne" class="panel-collapse collapse">
                            <div class="preview-box panel-body">
                              <div id="preview" class="editor-content-view"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-md-2 control-label">Palavras chave</label>
                      <div class="col-md-10">
                        <input class="tags" id="keywords" type="text" name="keywords">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-md-2 control-label">Anexar arquivo(s)</label>
                      <div class="col-md-2">
                        <input id="file" type="file" name="files" accept="application/pdf" multiple>
                      </div>
                    </div>
                    <div class="form-actions">
                      <button class="btn btn-primary pull-right" id="submit-button" type="submit">Salvar</button>
                      <a class="btn pull-left back-to-list-button">Voltar para a lista</a>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>

<script type="text/javascript" src="~/plugins/wysiwyg/js/index.js"></script>
<script type="text/javascript" src="~/js/questionDetails/richtextbox.js"></script>
<script type="text/javascript" src="~/js/questionDetails/questiondetails.js"></script>